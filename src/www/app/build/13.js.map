{"version":3,"sources":["../../src/pages/smart-calendar/smart-calendar.module.ts","../../src/pages/smart-calendar/smart-calendar.ts"],"names":[],"mappings":"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","file":"13.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { SmartCalendarPage } from './smart-calendar';\n\n@NgModule({\n  declarations: [\n    SmartCalendarPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(SmartCalendarPage),\n  ],\n})\nexport class SmartCalendarPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/smart-calendar/smart-calendar.module.ts","import { DataProvider } from './../../providers/data/data';\nimport { AngularFirestore } from 'angularfire2/firestore';\nimport { AuthProvider } from './../../providers/auth/auth';\nimport { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { Collections, User, Event } from '../../app/app.models';\nimport { Observable } from 'rxjs';\nimport { flattenDeep } from 'lodash';\nimport moment from 'moment'\n\n@IonicPage()\n@Component({\n  selector: 'page-smart-calendar',\n  templateUrl: 'smart-calendar.html',\n})\nexport class SmartCalendarPage {\n  public completedTasks: string[] = [];\n\n  public events$: Observable<Event[]>;\n  public events: Event[] = [];\n  public loadedEvents: string[] = [];\n\n  public userSub: any;\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public auth: AuthProvider,\n    private afs: AngularFirestore,\n    private data: DataProvider,\n  ) {}\n\n  ionViewDidLoad() {\n    this.auth.user$.subscribe(user => {\n      if (user) {\n        this.afs\n          .collection(Collections.USER)\n          .doc<User>(user.uid)\n          .valueChanges()\n          .subscribe(\n            u =>\n              (this.completedTasks = u.completedTasks ? u.completedTasks : [])\n          );\n        if (!this.events$) this.loadEvents(user.uid);\n      }\n    });\n  }\n\n  loadEvents(uid: string) {\n    this.userSub = this.afs\n      .collection(Collections.USER)\n      .doc<User>(uid)\n      .valueChanges()\n      .subscribe(async user => {\n        if (!user.customCalendar) return;\n\n        const events = flattenDeep(\n          Object.values(user.customCalendar)\n        ).filter(\n          (e: any) =>\n            e.start.substr(0, 10) === moment().format('YYYY-MM-DD')\n        ) as any[];\n\n        console.log(events)\n\n        if (!user.completedTasks) user.completedTasks = [];\n        this.completedTasks = user.completedTasks;\n\n        /*let formatedEvents = []*/\n        if (this.events.length > 0) return;\n\n        for (let e of events) {\n          if (e.event && !this.loadedEvents.includes(e.event)) {\n            const eventDoc = await this.data.getDocAlt<Event>(\n              Collections.EVENT,\n              e.event\n            );\n\n            setTimeout(() => {\n              this.events.push({\n                // id: `smart-calendar-event-${e.content}`,\n                ...e,\n                id: eventDoc.id,\n                start: new Date(e.start),\n                title: e.content_name,\n                desc: eventDoc.desc,\n                date: new Date().toISOString(),\n                tasks: eventDoc.tasks,\n                links: eventDoc.links,\n                color:\n                  this.completedTasks.indexOf(eventDoc.id) >= 0\n                    ? { primary: '#5e4b8b', secondary: '#5e4b8b' }\n                    : { primary: '#CF4747', secondary: '#CF4747' },\n              });\n              this.loadedEvents.push(e.event);\n            }, 100);\n          }\n        }\n      });\n  }\n\n  openLink(url: string) {\n\n    console.log(url);\n\n    // Content Detail\n    if (url.includes('/content')) {\n      const [,, type, id] = url.split('/');\n      this.navCtrl.push('ClaseDetailPage', { type, id });\n    }\n\n  }\n\n  async toggleCompleted(id: string) {\n\n    console.log(id)\n\n    const userKey = `${Collections.USER}/${this.auth.user.uid}`\n    const _user = await this.data.getDocAlt<User>(Collections.USER, this.auth.user.uid);\n    const completedTasks: string[] = _user.completedTasks || []\n\n    if (completedTasks.indexOf(id) < 0) {\n\n      completedTasks.push(id)\n      await this.afs.doc(userKey).update({ completedTasks })\n      /* this.checkChanged.next({ id, added: true }); */\n\n    } else {\n      if (completedTasks.length > 0) completedTasks.splice(completedTasks.indexOf(id), 1)\n      await this.afs.doc(userKey).update({ completedTasks })\n      /* this.checkChanged.next({ id, added: false }); */\n    }\n\n    // this.stats.modifyCustomCounter(`event-${id}`, this.event.title, 1)\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/smart-calendar/smart-calendar.ts"],"sourceRoot":""}