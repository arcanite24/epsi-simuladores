{"version":3,"sources":["../../src/pages/top-users/top-users.module.ts","../../src/pages/top-users/top-users.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAyC;AACO;AACL;AAU3C;IAAA;IAAiC,CAAC;IAArB,kBAAkB;QAR9B,+DAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,gEAAY;aACb;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,gEAAY,CAAC;aACvC;SACF,CAAC;OACW,kBAAkB,CAAG;IAAD,yBAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACZmB;AAGO;AACF;AACnB;AACmB;AACG;AAO1D;IAIE,sBACS,IAAkB,EACjB,GAAqB,EACrB,KAAoB;QAFrB,SAAI,GAAJ,IAAI,CAAc;QACjB,QAAG,GAAH,GAAG,CAAkB;QACrB,UAAK,GAAL,KAAK,CAAe;IAC1B,CAAC;IAEL,+BAAQ,GAAR;QAEE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAO,oEAAW,CAAC,IAAI,EAAE,aAAG,IAAI,UAAG;aACjE,KAAK,CAAC,UAAU,EAAE,GAAG,EAAE,CAAC,CAAC;aACzB,OAAO,CAAC,UAAU,EAAE,MAAM,CAAC;aAC3B,KAAK,CAAC,CAAC,CAAC,EAHsD,CAGtD,CAAC;aACT,YAAY,EAAE;QAEjB,IAAI,CAAC,WAAW,EAAE;IAEpB,CAAC;IAEK,kCAAW,GAAjB;;;;;4BAEwB,qBAAM,IAAI,CAAC,GAAG,CAAC,UAAU,CAAO,oEAAW,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,CAAC,IAAI,CAAC,4DAAI,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE;;wBAA1G,KAAK,GAAW,SAA0F;8BAExF,EAAL,eAAK;;;6BAAL,oBAAK;wBAAb,IAAI;wBACI,qBAAM,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,IAAI,CAAC,GAAG,CAAC;;wBAAxD,QAAQ,GAAG,SAA6C;wBAC9D,qBAAM,IAAI,CAAC,GAAG,CAAC,GAAG,CAAI,oEAAW,CAAC,IAAI,SAAI,IAAI,CAAC,GAAK,CAAC,CAAC,MAAM,CAAC,EAAC,QAAQ,EAAE,QAAQ,EAAC,CAAC;;wBAAlF,SAAkF;;;wBAFjE,IAAK;;;;;;KAKzB;IA/BU,YAAY;QAJxB,gEAAS,CAAC;YACT,QAAQ,EAAE,gBAAgB;WACG;SAC9B,CAAC;sFAM2B;YACZ,+EAAgB;YACd,SAAa;OAPnB,YAAY,CAiCxB;IAAD,CAAC;AAAA;SAjCY,YAAY,gB","file":"9.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TopUsersPage } from './top-users';\n\n@NgModule({\n  declarations: [\n    TopUsersPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(TopUsersPage),\n  ],\n})\nexport class TopUsersPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/top-users/top-users.module.ts","import { Component, OnInit } from '@angular/core';\nimport { IonicPage } from 'ionic-angular';\nimport {Observable} from \"rxjs\";\nimport {AngularFirestore} from \"@angular/fire/firestore\";\nimport {Collections, User} from \"../../app/app.models\";\nimport {take} from \"rxjs/operators\";\nimport {AuthProvider} from \"../../providers/auth/auth\";\nimport {StatsProvider} from \"../../providers/stats/stats\";\n\n@IonicPage()\n@Component({\n  selector: 'page-top-users',\n  templateUrl: 'top-users.html',\n})\nexport class TopUsersPage implements OnInit {\n\n  public users$: Observable<User[]>\n\n  constructor(\n    public auth: AuthProvider,\n    private afs: AngularFirestore,\n    private stats: StatsProvider,\n  ) { }\n\n  ngOnInit() {\n\n    this.users$ = this.afs.collection<User>(Collections.USER, ref => ref\n      .where('promedio', '>', 0)\n      .orderBy('promedio', 'desc')\n      .limit(5))\n      .valueChanges()\n\n    this.reloadUsers()\n\n  }\n\n  async reloadUsers() {\n\n    const users: User[] = await this.afs.collection<User>(Collections.USER).valueChanges().pipe(take(1)).toPromise()\n\n    for (const user of users) {\n      const promedio = await this.stats.computeUserAverage(user.uid)\n      await this.afs.doc(`${Collections.USER}/${user.uid}`).update({promedio: promedio})\n    }\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/top-users/top-users.ts"],"sourceRoot":""}