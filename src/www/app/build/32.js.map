{"version":3,"sources":["../../src/pages/examen-detail/examen-detail.module.ts","../../src/pages/examen-detail/examen-detail.ts"],"names":[],"mappings":"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","file":"32.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ExamenDetailPage } from './examen-detail';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ExamenDetailPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ExamenDetailPage),\r\n  ],\r\n})\r\nexport class ExamenDetailPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/examen-detail/examen-detail.module.ts","import { BackProvider } from './../../providers/back/back';\r\nimport { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, ToastController, ViewController, ModalController } from 'ionic-angular';\r\nimport { Observable } from 'rxjs';\r\nimport { Exam, Collections } from '../../app/app.models';\r\nimport { AngularFirestore } from 'angularfire2/firestore';\r\nimport { tap } from 'rxjs/operators';\r\n\r\n@IonicPage({segment: 'examen/:type/:id'})\r\n@Component({\r\n  selector: 'page-examen-detail',\r\n  templateUrl: 'examen-detail.html',\r\n})\r\nexport class ExamenDetailPage {\r\n  \r\n  public id: string = this.navParams.get('id')\r\n  public type: string = this.navParams.get('type')\r\n  private isOffline: boolean = this.navParams.get('offline')\r\n\r\n  public exam$: Observable<Exam>\r\n\r\n  public test: any\r\n  public l: boolean = false\r\n\r\n  public index: number = 0\r\n\r\n  private cacheKey: string = `examen-download-${this.type}-${this.id}`\r\n  private cacheList: any[] = []\r\n  public testCache: any = !!localStorage.getItem(this.cacheKey)\r\n  public s: any = this.navParams.get('s') ? JSON.parse(this.navParams.get('s')) : null\r\n\r\n  constructor(\r\n    public navCtrl: NavController,\r\n    public navParams: NavParams,\r\n    private back: BackProvider,\r\n    private toast: ToastController,\r\n    public viewCtrl: ViewController,\r\n    private modal: ModalController,\r\n    private afs: AngularFirestore\r\n  ) {\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n\r\n    this.exam$ = this.afs.collection(Collections.EXAM).doc<Exam>(this.id)\r\n      .valueChanges()\r\n      .pipe(\r\n        tap(data => {\r\n          this.test = {name: data.name, preguntas: data.questions}\r\n        })\r\n      )\r\n\r\n    /* if (this.s) return this.test = this.s.test\r\n    \r\n    this.back.getClase(this.id, this.type).subscribe(data => {\r\n      if (!data.preguntas || data.preguntas.length <= 0) {\r\n        this.toast.create({message: 'No existe un exámen para ésta clase...', duration: 2000}).present()\r\n        this.viewCtrl.dismiss()\r\n      } else {\r\n        this.test = {name: data.name, preguntas: data.preguntas}\r\n        const cache = JSON.parse(localStorage.getItem(`examen-cache-${this.type}-${this.id}`))\r\n        if (cache) {\r\n          this.index = cache.index\r\n          this.test.preguntas[this.index].s = cache.selected\r\n        }\r\n      }\r\n    }, err => {\r\n      this.toast.create({message: 'No se pudo cargar el exámen...', duration: 2000}).present()\r\n    })\r\n\r\n    this.loadCacheList() */\r\n\r\n  }\r\n\r\n  enviarResultados() {\r\n\r\n    this.l = true\r\n\r\n    let resultados = {}\r\n    this.test.preguntas.forEach(p => {\r\n      resultados[p.id] = {\r\n        selected: p.s,\r\n        pregunta: p\r\n      }\r\n    })\r\n\r\n    if (this.isOffline) {\r\n\r\n      const list = JSON.parse(localStorage.getItem('offline-results'))\r\n      const offlineResults = list ? list : []\r\n\r\n      offlineResults.push(resultados)\r\n      localStorage.setItem('offline-results', JSON.stringify(offlineResults))\r\n\r\n      this.toast.create({message: 'Tus resultados se guardaron correctamente.', duration: 2000}).present()\r\n      this.viewCtrl.dismiss(resultados)\r\n\r\n    } else {\r\n\r\n      this.back.addResultado(this.type, this.back.uid, this.id, resultados).subscribe(data => {\r\n        this.toast.create({message: 'Resultados registrados correctamente.', duration: 2000}).present()\r\n        this.viewCtrl.dismiss(data)\r\n      }, err => {\r\n        this.l = false\r\n        this.toast.create({message: 'No se pudieron agregar tus resultados...', duration: 2000}).present()\r\n      })\r\n\r\n    }\r\n\r\n  }\r\n\r\n  openResultados(id, type) {\r\n    const m = this.modal.create('ResultadosExamenPage', {type, id})\r\n    m.present()\r\n  }\r\n\r\n  next() {\r\n    if (this.index == this.test.preguntas.length - 1) {\r\n      this.enviarResultados()\r\n    } else {\r\n      this.saveCache()\r\n      this.index++\r\n    }\r\n  }\r\n\r\n  saveCache() {\r\n\r\n    let resultados = {}\r\n    let selected = this.test.preguntas[this.index].s\r\n    this.test.preguntas.forEach(p => {\r\n      resultados[p.id] = {\r\n        selected: p.s,\r\n        pregunta: p\r\n      }\r\n    })\r\n\r\n    localStorage.setItem(`examen-cache-${this.type}-${this.id}`, JSON.stringify({\r\n      index: this.index,\r\n      resultados,\r\n      selected\r\n    }))\r\n\r\n    localStorage.setItem(`examen-selected-${this.type}-${this.id}-${this.index}`, this.test.preguntas[this.index].s)\r\n\r\n  }\r\n\r\n  prev() {\r\n\r\n    this.index--\r\n\r\n    const selected = localStorage.getItem(`examen-selected-${this.type}-${this.id}-${this.index}`)\r\n    if (selected) this.test.preguntas[this.index].s = selected\r\n\r\n  }\r\n\r\n  openAvance() {\r\n\r\n    const m = this.modal.create('AvanceExamenPage', {preguntas: this.test.preguntas})\r\n    m.present()\r\n\r\n    m.onDidDismiss(index => {\r\n      if (!index) return\r\n      this.index = index\r\n    })\r\n\r\n  }\r\n\r\n  loadCacheList() {\r\n    const list = JSON.parse(localStorage.getItem('zamnademy-cache-list'))\r\n    this.cacheList = list ? list : []\r\n  }\r\n\r\n  downloadExamen() {\r\n    const cache = {\r\n      id: this.id,\r\n      type: this.type,\r\n      test: this.test\r\n    }\r\n    this.cacheList.push({\r\n      id: cache.id,\r\n      name: cache.test.name,\r\n      type: cache.type\r\n    })\r\n    localStorage.setItem('zamnademy-cache-list', JSON.stringify(this.cacheList))\r\n    localStorage.setItem(this.cacheKey, JSON.stringify(cache))\r\n    this.testCache = cache\r\n    this.toast.create({message: 'Exámen descargado correctamente.', duration: 2000}).present()\r\n  }\r\n\r\n  removeExamen() {\r\n    localStorage.removeItem(this.cacheKey)\r\n    this.cacheList = this.cacheList.filter(test => test.id != this.id)\r\n    localStorage.setItem('zamnademy-cache-list', JSON.stringify(this.cacheList)) \r\n    this.testCache = null\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/examen-detail/examen-detail.ts"],"sourceRoot":""}