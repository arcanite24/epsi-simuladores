{"version":3,"sources":["../../src/pages/pago-add/pago-add.module.ts","../../src/pages/pago-add/pago-add.ts"],"names":[],"mappings":"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","file":"12.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { PagoAddPage } from './pago-add';\n\n@NgModule({\n  declarations: [\n    PagoAddPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(PagoAddPage),\n  ],\n})\nexport class PagoAddPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pago-add/pago-add.module.ts","import { BackProvider } from './../../providers/back/back';\nimport { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ToastController, LoadingController, ModalController } from 'ionic-angular';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { Collections } from '../../app/app.models';\nimport { AuthProvider } from '../../providers/auth/auth';\nimport { PayProvider } from '../../providers/pay/pay';\nimport { production } from '../../app/app.config';\ndeclare var OpenPay\n\n@IonicPage()\n@Component({\n  selector: 'page-pago-add',\n  templateUrl: 'pago-add.html',\n})\nexport class PagoAddPage {\n\n  public control: any = this.navParams.get('control')\n  public amount: number\n  public Math = Math\n\n  public cards: any[] = []\n  public selectedCard: string\n  public method: string = 'card'\n  public recibo: string\n  public isPlan: boolean = false\n  public plan: number\n\n  private sess_id: string = OpenPay.deviceData.setup()\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public back: BackProvider,\n    private toast: ToastController,\n    private load: LoadingController,\n    private modal: ModalController,\n    private afs: AngularFirestore,\n    private auth: AuthProvider,\n    private pay: PayProvider\n  ) {\n  }\n\n  ionViewDidLoad(){\n    \n    if (!this.control) return this.navCtrl.setRoot('HomePage')\n\n    /* this.loadCards() */\n\n  }\n\n  /* loadCards() {\n    this.back.getUserTarjetas(this.back.uid).subscribe(data => this.cards = data, err => this.toast.create({message: 'No se pudieron cargar las tarjetas...', duration: 2000}).present())\n  } */\n\n  enableButton() {\n\n    if (this.method == 'card') {\n      /* if (!this.selectedCard) return false */\n      if (this.amount < 5) return false\n      if (this.amount > this.control.amountLeft) return false\n      return true\n    }\n\n    return true\n    \n  }\n\n  async pagar() {\n\n    if (!this.amount) return this.toast.create({message: 'Recuerda ingresar un monto para pagar...', duration: 2000}).present()\n\n    if (this.method == 'paypal') {\n      const m = this.modal.create('PaypalCheckoutPage', {amount: this.amount})\n      m.present()\n      m.onDidDismiss(data => this.handlePaypal(data))\n      return\n    }\n\n    const l = this.load.create({content: 'Generando pago...'})\n    l.present()\n\n    if (this.method == 'tienda') {\n\n      this.back.pagarPaynet(this.back.uid, this.amount, 'Pago Zamná', this.control.id, this.method).subscribe(data => {\n        console.log(data);\n        l.dismiss()\n        this.recibo = data.recibo\n      }, err => {\n        this.toast.create({message: 'No se pudo generar tu pago de Zamná', duration: 2000}).present()\n        l.dismiss()\n      })\n\n    } else if (this.method == 'card') {\n\n      const id = this.afs.createId()\n\n      let _control = {...this.control}\n      delete _control.pagos$\n\n      const pagoPayload = {\n        id,\n        user: this.auth.user.uid,\n        control: _control.id,\n        amount: parseFloat(this.amount.toString()),\n        method: this.method,\n        plan: this.plan ? this.plan : null,\n        status: 'waiting',\n        createdAt: new Date().toISOString(),\n        pago: {\n          status: 'waiting',\n          restado: false\n        }\n      }\n      console.log(pagoPayload)\n      await this.afs.collection(Collections.ZAMNA_PAGO).doc(id).set(pagoPayload)\n\n      const mercado = await this.pay.generatePaymentUrlZamnaPagos(\n        this.control.id,\n        id,\n        this.control.name,\n        parseFloat(this.amount.toString()),\n        production ? this.auth.user.email : 'test@test.com',\n        production\n      )\n\n      console.log(mercado.init_point)\n      window.location.href = mercado.init_point\n      l.dismiss()\n\n    } else {\n\n      const id = this.afs.createId()\n\n      let _control = {...this.control}\n      delete _control.pagos$\n\n      const pagoPayload = {\n        id,\n        user: this.auth.user.uid,\n        control: _control.id,\n        amount: parseFloat(this.amount.toString()),\n        method: this.method,\n        plan: this.plan ? this.plan : null,\n        status: 'uploading',\n        pago: {\n          status: 'uploading',\n          restado: false\n        }\n      }\n      console.log(pagoPayload)\n      await this.afs.collection(Collections.ZAMNA_PAGO).doc(id).set(pagoPayload)\n      this.navCtrl.pop()\n      l.dismiss()\n\n    }\n\n  }\n\n  /* openTarjetaAdd() {\n\n    const m = this.modal.create('TarjetaAddPage')\n    m.present()\n\n    m.onDidDismiss(data => this.loadCards())\n\n  } */\n\n  async handlePaypal(payment: any) {\n\n    if (!payment) return\n\n    const l = this.load.create({content: 'Generando pago...'})\n    l.present()\n\n    const id = this.afs.createId()\n\n    let _control = {...this.control}\n    delete _control.pagos$\n\n    const pagoPayload = {\n      id,\n      user: this.auth.user.uid,\n      control: _control.id,\n      amount: parseFloat(this.amount.toString()),\n      method: this.method,\n      plan: this.plan ? this.plan : null,\n      status: 'approved',\n      pago: {\n        status: 'approved',\n        restado: true\n      }\n    }\n    \n    console.log(pagoPayload)\n    \n    await this.afs.collection(Collections.ZAMNA_PAGO).doc(id).set(pagoPayload)\n    await this.afs.collection(Collections.CONTROL_PAGO).doc(this.control.id).update({\n      amountLeft: this.control.amountLeft - pagoPayload.amount\n    })\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/pago-add/pago-add.ts"],"sourceRoot":""}