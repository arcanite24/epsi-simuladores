{"version":3,"sources":["../../src/pages/home/home.module.ts","../../src/pages/home/home.ts"],"names":[],"mappings":"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","file":"15.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { HomePage } from './home';\nimport { MomentModule } from 'ngx-moment';\n\n@NgModule({\n  declarations: [\n    HomePage,\n  ],\n  imports: [\n    MomentModule,\n    IonicPageModule.forChild(HomePage),\n  ],\n})\nexport class HomePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.module.ts","import { BackProvider } from './../../providers/back/back';\nimport { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ToastController, LoadingController, ModalController, AlertController } from 'ionic-angular';\nimport moment from 'moment'\nimport { AuthProvider } from '../../providers/auth/auth';\nimport { User, Collections, PayTemplate } from '../../app/app.models';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { tap, take } from 'rxjs/operators';\nmoment.locale('es')\n\n@IonicPage()\n@Component({\n  selector: 'page-home',\n  templateUrl: 'home.html',\n})\nexport class HomePage {\n\n  private alertShown: boolean = false\n\n  public controles: any[] = []\n  public get uid() {\n    return localStorage.getItem('uid')\n  }\n\n  public selectedTemplate: any\n  public templates: PayTemplate[];\n  // public templates: any[] = [\n  //   {\n  //     tag: 'isPresencial2020',\n  //     price: 16350,\n  //     priceTag: '$ 16,350',\n  //     name: 'Curso Presencial',\n  //     limitDate: new Date('04-30-2020').toISOString()\n  //   },\n  //   {\n  //     tag: 'isPresencial360_2020',\n  //     price: 18600,\n  //     priceTag: '$16,350 + $2,250',\n  //     name: 'Curso Presencial 360',\n  //     limitDate: new Date('04-30-2020').toISOString()\n  //   }\n  // ]\n\n  /* {\n  tag: 'isEsencial360',\n    price: 18399,\n      priceTag: '$17,480 + $919',\n        name: 'Zamná 360 esencial',\n          //limitDate: moment(\"20183006\", \"YYYYMMDD\").toISOString()\n          limitDate: new Date('06-30-2018').toISOString()\n  //limitDate: moment('Tue Apr 30 2019 23:59:58 GMT-0500 (hora de verano central)').toISOString(),\n},\n{\n  tag: 'isPresencial',\n    price: 17480,\n      priceTag: '$17,480',\n        name: 'Zamná Presencial',\n          //limitDate: moment(\"20183006\", \"YYYYMMDD\").toISOString()\n          limitDate: new Date('06-30-2018').toISOString()\n  //limitDate: moment('Tue Apr 30 2019 23:59:58 GMT-0500 (hora de verano central)').toISOString(),\n},\n{\n  tag: 'isPremium360',\n    price: 20239,\n      priceTag: '$17,480 + $2,759',\n        name: 'Zamná 360 Premium',\n          //limitDate: moment(\"20183006\", \"YYYYMMDD\").toISOString()\n          limitDate: new Date('06-30-2018').toISOString()\n  //limitDate: moment('Tue Apr 30 2019 23:59:58 GMT-0500 (hora de verano central)').toISOString(),\n} */\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public back: BackProvider,\n    private toast: ToastController,\n    private load: LoadingController,\n    private modal: ModalController,\n    private alert: AlertController,\n    public auth: AuthProvider,\n    private afs: AngularFirestore\n    ) {\n  }\n\n  ionViewDidLoad(){\n\n    this.loadTemplates();\n\n    this.auth.user$.subscribe(user => {\n      // if (user && this.auth.isViewPagos) return this.navCtrl.setRoot('AdminPage')\n      if (user) {\n        this.checkForUserInfo(user)\n        this.loadControles(user.email)\n      }\n    })\n\n\n  }\n\n  async loadTemplates() {\n\n    const templates = await this.afs\n      .collection<PayTemplate>(Collections.PayTemplate)\n      .valueChanges()\n      .pipe(take(1))\n      .toPromise();\n\n    this.templates = templates.map(t => ({\n      ...t,\n      limitDate: new Date(t.limitDate).toISOString()\n    }))\n\n  }\n\n  loadControles(email: string) {\n    /* this.back.getUserControlesPago(this.back.uid).subscribe(data => this.controles = data) */\n    this.afs.collection(Collections.CONTROL_PAGO, ref => ref\n      .where('user.email', '==', email))\n      .valueChanges()\n      .pipe(tap(console.log))\n      .subscribe(data => this.controles = data.map(c => ({\n        ...c,\n        pagos$: this.afs.collection(Collections.ZAMNA_PAGO, ref => ref.where('control', '==', c.id)).valueChanges()\n      })))\n  }\n\n  formatDate(date: string) { return moment(date).calendar() }\n\n  gotoPagar(control: any) {\n    this.navCtrl.push('PagoAddPage', {control})\n  }\n\n  async createControlPago(control_tag: any) {\n\n    const l = this.load.create({content: 'Creando solicitud de pago...'})\n    l.present()\n\n    let control = this.templates.filter(t => t.tag == control_tag)[0]\n    control.id = this.afs.createId()\n    control.user = this.auth.user\n    control.amountLeft = control.price\n\n    let deudaTotal = this.auth.user.deudaTotal ? this.auth.user.deudaTotal : 0\n    let deuda = this.auth.user.deuda ? this.auth.user.deuda : 0\n\n    await this.afs.collection(Collections.USER).doc(this.auth.user.uid).update({deudaTotal: deudaTotal + control.price})\n    await this.afs.collection(Collections.USER).doc(this.auth.user.uid).update({deuda: deuda + control.price})\n\n    await this.afs.collection(Collections.CONTROL_PAGO).doc(control.id).set(control)\n    await this.afs.collection(Collections.USER).doc(this.auth.user.uid).update({[control_tag]: true})\n\n    this.toast.create({message: 'Control de pago creado correctamente.', duration: 2000}).present()\n    l.dismiss()\n\n  }\n\n  async removeControlPago(id: string) {\n    await this.afs.collection(Collections.CONTROL_PAGO).doc(id).delete()\n    await this.afs.collection(Collections.USER).doc(this.auth.user.uid).update({deuda: 0, deudaTotal: 0})\n    this.toast.create({message: 'Control de Pago eliminado correctamente, deuda y deudaTotal seteados a 0', duration: 2000}).present()\n  }\n\n  async logout() {\n    await this.auth.logout()\n    this.navCtrl.setRoot('LoginPage')\n  }\n\n  openPagoDetail(pago: any) {\n\n    const m = this.modal.create('PagoDetailPage', {pago})\n    m.present()\n\n  }\n\n  async checkForUserInfo(user: User) {\n\n    // const user = await this.back.getUserDetail(this.back.uid).toPromise()\n\n    if (!user.celular && !this.alertShown) {\n\n      const alert = this.alert.create({\n        title: 'Número de Celular',\n        subTitle: 'Parece que no haz llenado tu número de celular en tu perfil',\n        buttons: [\n          {\n            text: 'Ir a Perfil',\n            handler: () => {\n              this.navCtrl.push('ProfilePage')\n            }\n          },\n          {\n            text: 'Cerrar',\n            role: 'cancel'\n          }\n        ]\n      })\n\n      alert.present()\n      this.alertShown = true\n\n    }\n\n  }\n\n  openAdmin() {\n\n    const alert = this.alert.create({\n      title: 'Selecciona alumnos',\n      buttons: [\n        {\n          text: 'Alumnos 2019',\n          handler: () => {\n            this.navCtrl.push('AdminPage', {\n              mode: 'roles',\n              method: null,\n              payload: ['isEsencial360', 'isPresencial', 'isPremium360'],\n            });\n          },\n        },\n        {\n          text: 'Alumnos 2020',\n          handler: () => {\n            this.navCtrl.push('AdminPage', {\n              mode: 'roles',\n              method: null,\n              payload: ['isPresencial2020', 'isPresencial360_2020'],\n            });\n          },\n        },\n        {\n          text: 'Cerrar',\n          role: 'cancel',\n        },\n      ],\n    });\n\n    alert.present();\n\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.ts"],"sourceRoot":""}