{"version":3,"sources":["../../src/pages/admin-control-detail/admin-control-detail.module.ts","../../src/pages/admin-control-detail/admin-control-detail.ts"],"names":[],"mappings":"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","file":"14.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { AdminControlDetailPage } from './admin-control-detail';\nimport { MomentModule } from 'ngx-moment';\n\n@NgModule({\n  declarations: [\n    AdminControlDetailPage,\n  ],\n  imports: [\n    MomentModule,\n    IonicPageModule.forChild(AdminControlDetailPage),\n  ],\n})\nexport class AdminControlDetailPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/admin-control-detail/admin-control-detail.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ToastController, LoadingController, ModalController, ViewController } from 'ionic-angular';\nimport { BackProvider } from '../../providers/back/back';\nimport _ from 'lodash'\nimport { AuthProvider } from '../../providers/auth/auth';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { Collections, EsencialModel, PremiumModel, TempranoModel, User } from '../../app/app.models';\nimport { Observable } from 'rxjs';\n\n@IonicPage()\n@Component({\n  selector: 'page-admin-control-detail',\n  templateUrl: 'admin-control-detail.html',\n})\nexport class AdminControlDetailPage {\n\n  public control: any = this.navParams.get('control')\n  public pagos: any[]\n\n  public esencialModel = EsencialModel\n  public premiumModel = PremiumModel\n  public tempranoModel = TempranoModel\n\n  public user$: Observable<User>\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private toast: ToastController,\n    public back: BackProvider,\n    private load: LoadingController,\n    private modal: ModalController,\n    public viewCtrl: ViewController,\n    public auth: AuthProvider,\n    private afs: AngularFirestore\n    ) {\n  }\n\n  ionViewDidLoad() {\n    if (!this.control) this.navCtrl.setRoot('AdminPage')\n    this.loadControl()\n  }\n\n  loadControl() {\n    this.afs.collection(Collections.CONTROL_PAGO).doc(this.control.id).valueChanges().subscribe(data => {\n      this.control = data\n      this.afs.collection(Collections.ZAMNA_PAGO, ref => ref\n        .where('control', '==', this.control.id))\n        .valueChanges()\n        .subscribe(pagos => {\n          console.log(this.control.id, pagos)\n          this.pagos = pagos\n          this.user$ = this.auth.findUserByEmail(this.control.user.email)\n        })\n    })\n  }\n\n  get totalPagado() {\n    if (!this.pagos) return 0\n    if (!this.control) return 0\n    if (!this.control.pagos) return 0\n    if (this.control.pagos.length <= 0) return 0\n    console.log(this.pagos);\n    return this.pagos\n      .filter(p => p.status === 'approved' || p.pago.status === 'approved' || p.pago.status === 'completed')\n      .map(p => parseInt(p.amount.toString()))\n      .reduce((a, b) => a + b, 0);\n  }\n\n  async updateControlField(field: string, editField: string) {\n\n    await this.afs.collection(Collections.CONTROL_PAGO).doc(this.control.id).update({[field]: this.control[field]})\n    this.control[editField] = false\n\n  }\n\n  openPagoDetail(pago: any) {\n\n    const m = this.modal.create('PagoDetailPage', {pago})\n    m.present()\n    /* m.onDidDismiss(data => this.loadControl()) */\n\n  }\n\n  deleteControl(id: string) {\n    this.afs.collection(Collections.CONTROL_PAGO).doc(id).delete()\n    /* this.back.deleteControlPago(id).subscribe(data => this.navCtrl.setRoot('AdminPage'), err => this.toast.create({message: 'No se pudo borrar el control de pago...', duration: 2000}).present()) */\n  }\n\n  setRole(roles: string, uid: string) {\n\n    let payload = {}\n\n    for (const role of roles) {\n      payload[role] = true\n    }\n\n    this.afs.collection(Collections.USER).doc(uid).update(payload)\n\n  }\n\n  removeRole(roles: string[], uid: string) {\n\n    let payload = {}\n\n    for (const role of roles) {\n      payload[role] = false\n    }\n\n    this.afs.collection(Collections.USER).doc(uid).update(payload)\n\n  }\n\n  isRole(role: string): boolean {\n    if (!this.control) return false\n    if (!this.control.user) return false\n    return this.control.user.roles.indexOf(role) >= 0\n  }\n\n  saveRoles(roles: string[]) {\n    this.back.updateUser(this.control.user.id, {roles}).subscribe(data => this.toast.create({message: 'Permisos guardados correctamente...', duration: 2000}).present())\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/admin-control-detail/admin-control-detail.ts"],"sourceRoot":""}